<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ballerina Game — シンプルな操るゲーム</title>
  <style>
    :root{font-family:system-ui, -apple-system, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif}
    html,body{height:100%;margin:0;background:linear-gradient(#ffdfe8,#fff);}
    #gameWrap{width:100%;height:100vh;display:flex;align-items:center;justify-content:center}
    canvas{background:linear-gradient(#fff,#f6f6ff);box-shadow:0 8px 24px rgba(0,0,0,0.12);border-radius:12px}
    .hud{position:fixed;left:16px;top:16px;background:rgba(255,255,255,0.8);padding:8px 12px;border-radius:8px;backdrop-filter:blur(4px)}
    .controls{position:fixed;right:16px;bottom:16px;display:flex;gap:8px}
    .btn{width:64px;height:64px;border-radius:12px;background:rgba(255,255,255,0.9);display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,0,0,0.12);font-weight:700}
    .small{width:48px;height:48px}
    @media (max-width:600px){canvas{width:92vw;height:60vh} .btn{width:54px;height:54px}}
  </style>
</head>
<body>
  <div id="gameWrap">
    <canvas id="game" width="900" height="500"></canvas>
  </div>
  <div class="hud" id="hud">Score: <span id="score">0</span> &nbsp;|&nbsp; Energy: <span id="energy">100</span></div>
  <div class="controls">
    <div class="btn" id="left">◀</div>
    <div class="btn" id="jump">⤴</div>
    <div class="btn" id="spin">⟳</div>
    <div class="btn small" id="right">▶</div>
  </div>

<script>
// --- Simple ballerina game (single-file) ---
// Controls:
//  - Left / Right arrows or A/D : move
//  - Space or W : jump
//  - S or Down or 'P' : pirouette (spin)
// Touch buttons at bottom-right provided for mobile.

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let W = canvas.width, H = canvas.height;

window.addEventListener('resize', ()=>{
  // keep canvas logical size fixed; let CSS scale it
});

// Game state
const floorY = H - 80;
let score = 0;
let energy = 100;

const ballerina = {
  x: W/2, y: floorY, vx: 0, vy: 0,
  width: 36, height: 120,
  onGround: true,
  facing: 1,
  angle: 0, // rotation for spin
  spinning: false,
  spinTime: 0
};

const GRAV = 0.7;
const FRICTION = 0.9;

const keys = {};
addEventListener('keydown', e=>{keys[e.key.toLowerCase()]=true; e.preventDefault();});
addEventListener('keyup', e=>{keys[e.key.toLowerCase()]=false;});

// touch controls
['left','right','jump','spin'].forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener('touchstart', e=>{ e.preventDefault(); keys[id]=true; });
  el.addEventListener('touchend', e=>{ e.preventDefault(); keys[id]=false; });
  el.addEventListener('mousedown', e=>{ keys[id]=true; });
  el.addEventListener('mouseup', e=>{ keys[id]=false; });
});

function update(){
  // horizontal movement
  let accel = 0;
  if (keys['arrowleft']||keys['a']||keys['left']){ accel -= 0.8; ballerina.facing = -1 }
  if (keys['arrowright']||keys['d']||keys['right']){ accel += 0.8; ballerina.facing = 1 }
  ballerina.vx += accel;
  ballerina.vx *= FRICTION;
  ballerina.x += ballerina.vx;

  // jump
  if ((keys[' ']||keys['w']||keys['arrowup']||keys['jump']) && ballerina.onGround){
    ballerina.vy = -14; ballerina.onGround = false;
    energy = Math.max(0, energy - 6);
  }

  // spin
  if ((keys['s']||keys['arrowdown']||keys['p']||keys['spin']) && energy>6){
    if(!ballerina.spinning){ ballerina.spinning = true; ballerina.spinTime = 0; }
  }

  // physics
  if(!ballerina.onGround){ ballerina.vy += GRAV; ballerina.y += ballerina.vy; }
  if(ballerina.y >= floorY){ ballerina.y = floorY; ballerina.vy = 0; ballerina.onGround = true; }

  // spinning behavior
  if(ballerina.spinning){
    ballerina.spinTime += 1;
    ballerina.angle += 0.45 * (1 + ballerina.spinTime/20);
    energy = Math.max(0, energy - 0.6);
    if(ballerina.spinTime > 60 || energy<=0){ ballerina.spinning = false; ballerina.angle = 0; }
    score += 1; // reward for spinning
  } else {
    // small sway when standing
    ballerina.angle *= 0.9;
  }

  // energy recharge when grounded and not spinning
  if(ballerina.onGround && !ballerina.spinning){ energy = Math.min(100, energy + 0.25); }

  // boundaries
  if(ballerina.x < 40) ballerina.x = 40, ballerina.vx = 0;
  if(ballerina.x > W-40) ballerina.x = W-40, ballerina.vx = 0;

  // update HUD
  document.getElementById('score').textContent = Math.floor(score);
  document.getElementById('energy').textContent = Math.floor(energy);
}

function drawBallerina(x,y,angle,scale=1){
  ctx.save();
  ctx.translate(x,y-80);
  ctx.rotate(angle);
  ctx.scale(scale,scale);

  // simple stylized ballerina drawn with shapes (no external image)
  // head
  ctx.beginPath(); ctx.arc(0,-10,10,0,Math.PI*2); ctx.fillStyle = '#ffe0d9'; ctx.fill();
  // body
  ctx.beginPath(); ctx.ellipse(0,10,10,24,0,0,Math.PI*2); ctx.fillStyle='#ff79c6'; ctx.fill();
  // tutu (skirt)
  ctx.beginPath(); ctx.moveTo(-36,28); ctx.quadraticCurveTo(0,6,36,28); ctx.lineTo(20,46); ctx.quadraticCurveTo(0,22,-20,46); ctx.closePath(); ctx.fillStyle='#ffd6f0'; ctx.fill();
  // left arm
  ctx.beginPath(); ctx.moveTo(-8,0); ctx.quadraticCurveTo(-44,-6,-52,8); ctx.lineWidth=6; ctx.strokeStyle='#ffe0d9'; ctx.lineCap='round'; ctx.stroke();
  // right arm
  ctx.beginPath(); ctx.moveTo(8,0); ctx.quadraticCurveTo(40,-6,52,8); ctx.lineWidth=6; ctx.strokeStyle='#ffe0d9'; ctx.lineCap='round'; ctx.stroke();
  // left leg
  ctx.beginPath(); ctx.moveTo(-8,40); ctx.lineTo(-10,70); ctx.lineWidth=6; ctx.strokeStyle='#ffe0d9'; ctx.stroke();
  // right leg
  ctx.beginPath(); ctx.moveTo(8,40); ctx.lineTo(10,70); ctx.lineWidth=6; ctx.strokeStyle='#ffe0d9'; ctx.stroke();

  ctx.restore();
}

function draw(){
  ctx.clearRect(0,0,W,H);

  // stage
  ctx.fillStyle = '#f3f7ff'; ctx.fillRect(0,floorY+40,W,H-floorY-40);
  // wooden floor stripes
  for(let i=0;i<20;i++){
    ctx.fillStyle = i%2? 'rgba(0,0,0,0.02)' : 'rgba(0,0,0,0.01)';
    ctx.fillRect(i*(W/20), floorY+60, W/40, 6);
  }

  // spotlight
  const grad = ctx.createRadialGradient(ballerina.x, floorY-40, 10, ballerina.x, floorY-40, 220);
  grad.addColorStop(0,'rgba(255,255,220,0.9)'); grad.addColorStop(1,'rgba(255,255,220,0)');
  ctx.fillStyle = grad; ctx.beginPath(); ctx.ellipse(ballerina.x, floorY-40, 220, 80, 0, 0, Math.PI*2); ctx.fill();

  // draw ballerina
  drawBallerina(ballerina.x, ballerina.y - 20, ballerina.angle, 1);

  // small UI hints
  ctx.fillStyle='rgba(0,0,0,0.5)'; ctx.font='14px system-ui'; ctx.fillText('← →: move  ⤴: jump  ⟳: spin', 18, 28);
}

function loop(){ update(); draw(); requestAnimationFrame(loop); }
loop();

// simple resize handling so CSS scaling won't blur hit area (keeps logic same)
function setCanvasSize(w,h){ canvas.width = w; canvas.height = h; W = w; H = h; }
setCanvasSize(900,500);

// allow downloading a screenshot with 'k' key
addEventListener('keydown', e=>{ if(e.key==='k'){ const a = document.createElement('a'); a.href = canvas.toDataURL(); a.download='ballerina.png'; a.click(); }});

</script>
</body>
</html>
